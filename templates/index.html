<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Real-Time Object Detection</title>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eef6f8;
  text-align: center;
}

h1 {
  letter-spacing: 4px;
  margin-top: 20px;
}

.buttons button {
  padding: 12px 25px;
  margin: 10px;
  border: none;
  border-radius: 20px;
  background: #5bc8ac;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

.container {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-top: 30px;
}

.box {
  position: relative;
  width: 480px;
  height: 360px;
  background: white;
  border-radius: 15px;
}

video, canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 15px;
}

.info {
  width: 480px;
  background: white;
  border-radius: 15px;
  padding: 15px;
  text-align: left;
  overflow-y: auto;
}

li {
  margin-bottom: 10px;
}
</style>
</head>

<body>

<h1>REAL-TIME OBJECT DETECTION</h1>

<div class="buttons">
  <button onclick="startDetection()">Start Detection</button>
  <button onclick="stopDetection()">Stop Detection</button>
</div>

<div class="container">
  <div class="box">
    <video id="video" autoplay></video>
    <canvas id="canvas"></canvas>
  </div>

  <div class="info">
    <h3>Total Objects Detected: <span id="count">0</span></h3>
    <ul id="objectList"></ul>
  </div>
</div>

<script>
const socket = io();
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const list = document.getElementById("objectList");
const countEl = document.getElementById("count");

let stream;
let running = false;

async function startDetection() {
  stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
  running = true;
  sendFrame();
}

function stopDetection() {
  running = false;
  if (stream) stream.getTracks().forEach(t => t.stop());
}

function sendFrame() {
  if (!running) return;

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);

  socket.emit("frame", canvas.toDataURL("image/jpeg"));
  requestAnimationFrame(sendFrame);
}

socket.on("detections", data => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  list.innerHTML = "";
  countEl.innerText = data.count;

  data.objects.forEach(obj => {
    ctx.strokeStyle = "lime";
    ctx.lineWidth = 2;
    ctx.strokeRect(obj.x, obj.y, obj.w, obj.h);

    ctx.fillStyle = "lime";
    ctx.fillText(obj.label, obj.x, obj.y - 5);

    const li = document.createElement("li");
    li.innerHTML = `
      <b>${obj.label}</b><br>
      ${obj.description}<br>
      Width: ${obj.w}px | Height: ${obj.h}px
    `;
    list.appendChild(li);
  });
});
</script>

</body>
</html>
